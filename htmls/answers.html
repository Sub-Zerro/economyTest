<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Таблица ответов</title>
</head>
<body>
  <script>

    (async ()=>{
        function get_num(){
            let num_quiz_promot = prompt("Введите номер квиза");

            if (num_quiz_promot == undefined || num_quiz_promot == '' || num_quiz_promot == null){
                get_num();
                console.log("error");
            }else{
                return num_quiz_promot;
            }
        }
        let num_quiz_promot = await get_num();


      console.log(num_quiz_promot);

      fetch("/answers", {
        method: "post",
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        //make sure to serialize your JSON body
        body: JSON.stringify({
          num_quiz: Number(num_quiz_promot)
        })
      }).then((res)=>{
          res.json().then((end_res)=>{

              let arr = end_res.arr;
              //console.log(end_res.counter);
              let temp;
              for (let i = 0; i < arr.length; i++){
                  for (let k = 0; k < arr.length; k++){
                      temp = arr[k];
                      if (k!=0){
                          if (arr[k-1][4]<arr[k][4]){
                              arr[k] = arr[k-1];
                              arr[k-1] = temp;
                              //console.log(`${arr[k][4]} < ${arr[k-1][4]}`);

                          }
                      }
                  }
              }
              //console.log(arr);

              let delitel = arr[0][1].length;
              let div;
              let p;
              let br;
              for (let i = 0; i < end_res.counter; i++){
                  div = document.createElement("div");
                  div.style.width = '500px';


                  for (let i = 0; i<arr.length; i++){
                      p = document.createElement("div");
                      p.textContent = `${arr[i][0]} - ${arr[i][4]} баллов из ${arr[i][1].length}, (${Math.round((100/delitel)*arr[i][4])} %) ${arr[i][2]}`;
                      div.appendChild(p);
                      br = document.createElement("br");
                      div.appendChild(br);
                  }

                  document.body.appendChild(div);
              }

          })
      })
    })()



  </script>
</body>
</html>